@rendermode @(AppDomain.CurrentDomain.FriendlyName.Contains("Tea.Web") ? Microsoft.AspNetCore.Components.Web.RenderMode.InteractiveServer : null)
@page "/order-success"
@using Tea.Shared.Services
@using Tea.Shared.Models
@using Tea.Shared.Components
@inject LanguageService LanguageService
@inject CartService CartService
@inject NavigationManager Navigation
@implements IDisposable

<PageTitle>@LanguageService.GetText("‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - BUBBLICIOUS", "Order Success - BUBBLICIOUS")</PageTitle>

<div class="order-success-container">
    <div class="language-toggle-container">
        <LanguageToggle />
    </div>

    <div class="success-content">
        <div class="celebration-animation">
            <div class="confetti">
                <div class="confetti-piece confetti-1">üéâ</div>
                <div class="confetti-piece confetti-2">üéä</div>
                <div class="confetti-piece confetti-3">‚ú®</div>
                <div class="confetti-piece confetti-4">üéâ</div>
                <div class="confetti-piece confetti-5">üéä</div>
                <div class="confetti-piece confetti-6">‚ú®</div>
            </div>
        </div>

        <div class="success-icon">
            <div class="checkmark">‚úì</div>
        </div>

        <h1 class="success-title">
            @LanguageService.GetText("‡πÄ‡∏¢‡πâ! ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!", "Woohoo! Order Placed Successfully!")
        </h1>

        <div class="order-details">
            <div class="order-number">
                <span class="label">@LanguageService.GetText("‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:", "Order Number:")</span>
                <span class="number">@orderNumber</span>
            </div>

            <div class="preparation-time">
                <div class="time-icon">‚è∞</div>
                <div class="time-info">
                    <h3>@LanguageService.GetText("‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°", "Preparation Time")</h3>
                    <p class="time-estimate">@preparationTime @LanguageService.GetText("‡∏ô‡∏≤‡∏ó‡∏µ", "minutes")</p>
                    <p class="time-note">@LanguageService.GetText("‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏≤‡∏ô‡πå‡πÄ‡∏ï‡∏≠‡∏£‡πå", "Please wait for your order at the counter")</p>
                </div>
            </div>

            <div class="thank-you-message">
                <h3>@LanguageService.GetText("‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£", "Thank you for your order!")</h3>
                <p>@LanguageService.GetText("‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏™‡∏î‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏™‡πà‡πÉ‡∏à", "We'll prepare your fresh beverages with care")</p>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn-primary order-again-btn" @onclick="OrderAgain">
                @LanguageService.GetText("‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", "Order Again")
            </button>
            <button class="btn-secondary" @onclick="GoToMenu">
                @LanguageService.GetText("‡∏î‡∏π‡πÄ‡∏°‡∏ô‡∏π", "View Menu")
            </button>
        </div>

        <div class="floating-bubbles-success">
            <div class="bubble-success bubble-1"></div>
            <div class="bubble-success bubble-2"></div>
            <div class="bubble-success bubble-3"></div>
            <div class="bubble-success bubble-4"></div>
        </div>
    </div>
</div>

@code {
    private string orderNumber = "";
    private int preparationTime = 12;

    protected override void OnInitialized()
    {
        LanguageService.LanguageChanged += StateHasChanged;
        orderNumber = CartService.GenerateOrderNumber();
        
        // ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 10-15 ‡∏ô‡∏≤‡∏ó‡∏µ
        var random = new Random();
        preparationTime = random.Next(10, 16);
        
        // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        CartService.ClearCart();
    }

    private void OrderAgain()
    {
        Navigation.NavigateTo("/");
    }

    private void GoToMenu()
    {
        Navigation.NavigateTo("/menu");
    }

    public void Dispose()
    {
        LanguageService.LanguageChanged -= StateHasChanged;
    }
}